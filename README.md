# Malware CC Recovery of PyRation variant Malware

The Malware CC Recovery is a project done by [Tomy-Niepo](https://github.com/tomy-niepo) as part of his internship in the [Stratosphere Laboratory](https://www.stratosphereips.org) to analyze real malware and understand its working.

This repository has the recovered code of the original malware, plus a new implementation of a Command and Control (CC) server and a new implementation of a botmaster bot.

The blog with the description can be found [here online](), or a PDF copy is in [here](). The slides of a presentation on all the work is [here](https://github.com/stratosphereips/Malware-CC-Recovery/blob/main/docs/Analysis%20and%20understanding%20a%20malware%20of%20the%20PyRation%20family.pdf).

## Analysis of the Original Malware
The original malware is a member of the PyRation variant family. It is a Windows PE file with hash MD5 67e77dcdbf046a0fd91a0bbb3e807831, SHA256 bba407734a2567c7e22e443ee5cc1b3a5780c9dd44c79b4a94d514449b0fd39a ([VT](https://www.virustotal.com/gui/file/bba407734a2567c7e22e443ee5cc1b3a5780c9dd44c79b4a94d514449b0fd39a)) and 

Previous analyses of this malware were partially done, for example [here](https://www.securonix.com/blog/security-advisory-python-based-pyration-attack-campaign/).

The original malware was done to run on Windows. My adaptation runs well on macOS and maybe Linux (did not finish testing).

## CC Server
Since the malware is only the bot part for Windows, there is no Command and Control server to try and see how it works. This is why I designed and created the CC server to be able to receive multiple bots and give them orders.

## BotMaster
The CC Server is the middle layer and communication software with the Bots (infected computers), but the orders need to come from someplace. My solution for this was to create a new type of client that acts as the botmaster and gives orders to the Bots through the CC server.

Part of the server was based on the ideas from https://github.com/yuv-c/server_client_websocket_chat.

# How to run

- Install the libraries
```bash
python3 -m venv myenv
source myenv/bin/activate
pip install -r requirements.txt
```

- Start the CC server
```bash
python ccserver.py
```

- Start the bots

In other console or computer, start a bot (repeat this for as many bots as you want)
```bash
python malware_client.py
```
If running on MacOS you will need to give permission to take screenshots of your computer as well as permission to listen to your keyboard on any app. This can be done in settings.

- Start the Botmaster
```bash
python botmaster.py
```

# How to use
From the console of the botmaster you can manage all the bots.
<img>

## 
